format_version: IaCService/2021-08-06
description: 日志统一投递

upstream_input:
  - name: resource_structure_stack
    source: "{IaCEndpoint}/{AccountId}/resource_structure"

deployment:
  - name: log_archive
    inputs:
      config_region: "cn-shanghai"
      actiontrail_region: "cn-hangzhou"
      oss_region: "cn-beijing"
      sls_region: "cn-shenzhen"
      log_account_id: upstream_input.resource_structure_stack.role_to_account_mapping.log
      # ActionTrail configuration
      enable_actiontrail_oss_delivery: true
      enable_actiontrail_sls_delivery: true
      actiontrail_trail_name: "landingzone-actiontrail-20250820"
      actiontrail_trail_status: "Enable"
      actiontrail_event_type: "All"
      actiontrail_trail_region: "All"
      actiontrail_is_organization_trail: true
      actiontrail_oss_bucket_name: "landingzone-actiontrail-bucket-20250821"
      actiontrail_oss_log_retention_days: 365
      actiontrail_oss_server_side_encryption_enabled: true
      actiontrail_oss_server_side_encryption_algorithm: "AES256"
      actiontrail_oss_write_role_arn: null
      actiontrail_oss_force_destroy: true
      actiontrail_sls_project_name: "landingzone-actiontrail-20250820"
      actiontrail_sls_project_description: "Landing Zone ActionTrail logs storage for testing"
      actiontrail_sls_logstore_name: "actiontrail-store-20250820"
      actiontrail_sls_retention_period: 180
      actiontrail_sls_write_role_arn: null
      actiontrail_tags:
        Environment: "test"
        Project: "landing-zone"
        CreatedBy: "terraform"
        TestCase: "actiontrail"
      # Config configuration
      config_oss_enabled: true
      config_oss_bucket_name: "landingzone-config-bucket-20250821"
      config_oss_bucket_force_destroy: true
      config_oss_bucket_versioning: true
      config_oss_bucket_tags:
        Environment: "test"
        Project: "landing-zone"
      config_oss_bucket_storage_class: "Standard"
      config_oss_bucket_acl: "private"
      config_oss_bucket_lifecycle_rule_enabled: true
      config_oss_bucket_lifecycle_expiration_days: 730
      config_oss_bucket_server_side_encryption_enabled: true
      config_oss_bucket_server_side_encryption_algorithm: "AES256"
      config_sls_enabled: true
      config_sls_project_name: "landingzone-config-project-20250820"
      config_sls_project_description: "Landing Zone Config delivery project for testing"
      config_sls_project_tags:
        Environment: "test"
        Project: "landing-zone"
      config_sls_logstore_name: "config-logstore-20250820"
      config_sls_logstore_retention_period: 180
      config_sls_logstore_shard_count: 2
      config_sls_logstore_auto_split: true
      config_sls_logstore_max_split_shard_count: 64
      config_aggregator_name: "landingzone-all-20250820"
      config_aggregator_description: "Landing Zone Config Aggregator for all accounts - Test"

publish_output:
  # ActionTrail outputs
  - name: actiontrail_trail_id
    description: "The ID of the ActionTrail trail"
    value: deployment.log_archive.actiontrail_trail_id
  - name: actiontrail_trail_name
    description: "The name of the ActionTrail trail"
    value: deployment.log_archive.actiontrail_trail_name
  - name: actiontrail_oss_bucket_name
    description: "The name of the OSS bucket for ActionTrail logs"
    value: deployment.log_archive.actiontrail_oss_bucket_name
  - name: actiontrail_sls_project_name
    description: "The name of the SLS project for ActionTrail logs"
    value: deployment.log_archive.actiontrail_sls_project_name
  - name: actiontrail_sls_logstore_name
    description: "The name of the SLS logstore for ActionTrail logs"
    value: deployment.log_archive.actiontrail_sls_logstore_name
  # Config outputs
  - name: config_aggregator_id
    description: "The ID of the config aggregator"
    value: deployment.log_archive.config_aggregator_id
  - name: config_aggregator_name
    description: "The name of the config aggregator"
    value: deployment.log_archive.config_aggregator_name
  - name: config_oss_bucket_name
    description: "The name of the OSS bucket for config delivery"
    value: deployment.log_archive.config_oss_bucket_name
  - name: config_oss_extranet_endpoint
    description: "The extranet access endpoint of the OSS bucket for config delivery"
    value: deployment.log_archive.config_oss_extranet_endpoint
  - name: config_oss_intranet_endpoint
    description: "The intranet access endpoint of the OSS bucket for config delivery"
    value: deployment.log_archive.config_oss_intranet_endpoint
  - name: config_sls_project_name
    description: "The name of the SLS project for config delivery"
    value: deployment.log_archive.config_sls_project_name
  - name: config_sls_project_description
    description: "The description of the SLS project for config delivery"
    value: deployment.log_archive.config_sls_project_description
  - name: config_sls_logstore_name
    description: "The name of the SLS logstore for config delivery"
    value: deployment.log_archive.config_sls_logstore_name
  - name: config_sls_retention_period
    description: "The retention period of the SLS logstore for config delivery"
    value: deployment.log_archive.config_sls_retention_period
  - name: config_delivery_channel_ids
    description: "The IDs of the config delivery channels"
    value: deployment.log_archive.config_delivery_channel_ids
